<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản Lý Chất Lượng Không Khí Huyện Đồng Hỷ</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body style="background-image: url('images/background.jpg'); background-size: cover; background-repeat: no-repeat;">
    <header>
        <h1>Chất Lượng Không Khí Huyện Đồng Hỷ</h1>
        <nav>
            <ul>
                <li><a href="#register">Đăng Ký</a></li>
                <li><a href="#login">Đăng Nhập</a></li>
                <li><a href="#articles">Bài Viết</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <section id="auth">
            <h2>Đăng Ký</h2>
            <form id="register-form">
                <input type="text" id="username" placeholder="Tên đăng nhập" required>
                <input type="password" id="password" placeholder="Mật khẩu" required>
                <button type="submit">Đăng Ký</button>
            </form>
            <h2>Đăng Nhập</h2>
            <form id="login-form">
                <input type="text" id="login-username" placeholder="Tên đăng nhập" required>
                <input type="password" id="login-password" placeholder="Mật khẩu" required>
                <button type="submit">Đăng Nhập</button>
            </form>
        </section>

        <section id="main-content" style="display:none;">
            <h2>Chất lượng không khí</h2>
            <div id="air-quality-alert" style="display:none; color: red; font-weight: bold;"></div>
            <canvas id="airQualityChart"></canvas>
            <h3>Các bài viết phân tích</h3>
            <ul id="articles-list"></ul>
        </section>
    </main>

    <script>
        const users = []; // Danh sách người dùng

        // Đăng ký người dùng
        document.getElementById('register-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const userExists = users.some(u => u.username === username);
            if (userExists) {
                alert('Tên đăng nhập đã tồn tại!');
            } else {
                users.push({ username, password });
                alert('Đăng ký thành công! Bạn có thể đăng nhập ngay bây giờ.');
            }
        });

        // Đăng nhập người dùng
        document.getElementById('login-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;
            const user = users.find(u => u.username === username && u.password === password);
            if (user) {
                document.getElementById('auth').style.display = 'none';
                document.getElementById('main-content').style.display = 'block';
                fetchAirQualityData(); // Gọi dữ liệu khi đã đăng nhập
            } else {
                alert('Tên đăng nhập hoặc mật khẩu không đúng!');
            }
        });

        // Hàm để lấy dữ liệu chất lượng không khí từ API
        async function fetchAirQualityData() {
            const apiKey = '7ddf9100e89da55116139544d0fa21e15d4038ee'; // Thay 'YOUR_API_KEY' bằng API key của bạn
            const city = 'Thai Nguyen'; // Tên thành phố bạn muốn lấy dữ liệu
            const url = `https://api.waqi.info/feed/${city}/?token=${apiKey}`;
            try {
                const response = await fetch(url);
                const data = await response.json();
                if (data.status === "ok") {
                    const aqi = data.data.aqi;
                    const aqiCategory = getAQICategory(aqi);
                    displayAirQualityAlert(aqiCategory);
                    displayAQIChart(data.data.iaqi);
                } else {
                    alert('Không thể lấy dữ liệu chất lượng không khí.');
                }
            } catch (error) {
                console.error('Lỗi:', error);
            }
        }

        // Hàm phân loại chất lượng không khí
        function getAQICategory(aqi) {
            if (aqi <= 50) return 'Tốt';
            else if (aqi <= 100) return 'Trung bình';
            else if (aqi <= 150) return 'Kém';
            else if (aqi <= 200) return 'Xấu';
            else if (aqi <= 300) return 'Rất xấu';
            else return 'Nguy hiểm';
        }

        // Hàm hiển thị cảnh báo chất lượng không khí
        function displayAirQualityAlert(aqiCategory) {
            const alertDiv = document.getElementById('air-quality-alert');
            alertDiv.style.display = 'block';
            alertDiv.innerText = `Cảnh báo chất lượng không khí: ${aqiCategory}`;
        }

        // Hàm hiển thị biểu đồ chất lượng không khí
        function displayAQIChart(iaqData) {
            const ctx = document.getElementById('airQualityChart').getContext('2d');
            const labels = Object.keys(iaqData);
            const values = Object.values(iaqData).map(item => item.v); // Lấy giá trị AQI cho từng chỉ số
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Chỉ số chất lượng không khí',
                        data: values,
                        backgroundColor: 'rgba(75, 192, 192, 0.6)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true,
                        }
                    }
                }
            });
        }

        // Hàm giả lập để thêm bài viết vào danh sách
        function addArticles() {
            const articles = [
                { title: "Phân Tích Chất Lượng Không Khí Tháng 1", content: "Dữ liệu cho thấy mức độ ô nhiễm cao vào tháng 1..." },
                { title: "Tác Động của Ô Nhiễm Đến Sức Khỏe", content: "Ô nhiễm không khí có thể gây ra nhiều vấn đề sức khỏe..." },
            ];
            const articlesList = document.getElementById('articles-list');
            articles.forEach(article => {
                const li = document.createElement('li');
                li.innerHTML = `${article.title}: ${article.content}`;
                articlesList.appendChild(li);
            });
        }

        // Thêm bài viết vào danh sách khi trang được tải
        addArticles();
    </script>
</body>
</html>
